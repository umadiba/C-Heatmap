/*
 *  jquery-calendar-heatmap - v1.1.0
 *  A simple Calendar Heatmap for jQuery.
 *  https://github.com/SeBassTian23/CalendarHeatmap
 *
 *  Made by Sebastian Kuhlgert
 *  Under MIT License
 */

!function(w){"use strict";var a="CalendarHeatmap",n={title:null,months:12,weekStartDay:1,lastMonth:moment().month()+1,lastYear:moment().year(),coloring:null,labels:{days:!1,months:!0,custom:{weekDayLabels:null,monthLabels:null}},tiles:{shape:"square"},legend:{show:!0,align:"right",minLabel:"Less",maxLabel:"More"},tooltips:{show:!1,options:{}}};function s(t,e,s){this.element=t,this.data=e,this.settings=w.extend(!0,{},n,s),this._defaults=n,this._name=a,this.init()}w.extend(s.prototype,{init:function(){this.calendarHeatmap(),moment||console.log("The calendar heatmap plugin requires moment.js")},parse:function(){var t=[],e=w.type(this.data);if(-1===["array","object"].indexOf(e))return console.log("Invalid data source"),null;if("array"===e&&0<this.data.length){var s=w.type(this.data[0]);if("object"===s){if(this.data[0].date&&this.data[0].count){for(var a in t=[],this.data){var n=this.data[a].date;w.isNumeric(this.data[a].date)&&(n=parseInt(this.data[a].date)),t.push({count:parseInt(this.data[a].count),date:moment(n).format("YYYY-MM-DD")})}return t}return console.log("Invalid Object format."),null}if(-1<["string","date","number"].indexOf(s)){if(moment(this.data[0]).isValid()){var l={};for(var i in this.data){var h=moment(this.data[i]).format("YYYY-MM-DD");console.log(h),l[h]?l[h]+=1:l[h]=1}for(var o in console.log(l),t=[],l)t.push({count:parseInt(l[o]),date:o});return t}return console.log("Invalid Date format."),null}return console.log("Invalid format."),null}if("array"===e&&0===this.data.length)return[];if("object"!==e||Object.empty(this.data))return null;var r=Object.keys(this.data);if(!moment(r[0]).isValid())return console.log("Invalid Date format."),null;if("number"===w.type(this.data[r[0]])){var d=[];for(var m in this.data)d.push({count:parseInt(this.data[m]),date:moment(m).format("YYYY-MM-DD")});return d}},pad:function(t,e){return(t=String(t)).length<e?this.pad("0"+t,e):t},calculateBins:function(t){var e,s=this.settings.steps||4,a=["0"],n=[[0,0]],l=t.map(function(t){return parseInt(t.count)}),i=Math.min.apply(Math,l),h=Math.max.apply(Math,l),o=(h-i)/s;for(0===o&&(o=h/s)<1&&(o=1),e=0;e<s;e++)if(isFinite(i))if(h<s)0<=e-(s-h)?(a.push(String(e-(s-h)+1)),n.push([e-(s-h)+1,e-(s-h)+1])):(a.push(""),n.push([null,null]));else if(h===s)a.push(String(e+1)),n.push([e+1,e+1]);else if(h/2<s)e+1===s?(a.push(String(e+1)+"+"),n.push([e+1,null])):(a.push(String(e+1)),n.push([e+1,e+1]));else{var r=Math.ceil(e*o)+1,d=Math.ceil(e*o+o);e===s-1&&(d=h),n.push([r,d]),e===s-1?r+="+":r!==d&&(r+=" to ",r+=d),a.push(String(r))}else a.push(""),n.push([null,null]);for(e in t)0===t[e].count?t[e].level=0:t[e].count-i==0?t[e].level=1:isFinite(i)?t[e].level=this.matchBin(n,t[e].count):t[e].level=s;return{events:t,bins:a}},matchBin:function(t,e){for(var s in t)if(e>=t[s][0]&&e<=t[s][1])return s;return 0},matchDate:function(t,e){return t.find(function(t){return t.date===e})||null},futureDate:function(t){return 0<=moment(t).diff(moment(),"days")&&moment(t).format("YYYY-MM-DD")!==moment().format("YYYY-MM-DD")},addWeekColumn:function(){if(this.settings.labels.days){w(".ch-year",this.element).append('<div class="ch-week-labels"></div>'),w(".ch-week-labels",this.element).append('<div class="ch-week-label-col"></div>'),w(".ch-week-label-col",this.element).append('<div class="ch-day-labels"></div>'),this.settings.labels.months&&w(".ch-week-labels",this.element).append('<div class="ch-month-label">&nbsp;</div>');for(var t=this.settings.weekStartDay,e=0;e<7;e++){var s=moment().weekday(e+t).format("ddd"),a=moment().weekday(e+t).format("d");if((e-1)%2){var n=this.settings.labels.custom.weekDayLabels;"array"===w.type(n)?s=n[a]||"":"string"===w.type(n)&&(s=moment().weekday(e+t).format(n))}else s="&nbsp;";w("<div>",{class:"ch-day-label",html:s}).appendTo(w(".ch-day-labels",this.element))}}},calendarHeatmap:function(){var t=this.parse();if("array"===w.type(t)){var e,s=this.calculateBins(t),a=s.events,n=s.bins,l=this.settings.lastMonth,i=this.settings.lastYear,h=this.settings.months,o=this.settings.weekStartDay||1;for(w(this.element).empty(),this.settings.title&&w("<h3>",{class:"ch-title",html:this.settings.title}).appendTo(w(this.element)),w(this.element).addClass("ch").append('<div class="ch-year"></div>'),this.addWeekColumn(),this.settings.tiles.shape&&"square"!==this.settings.tiles.shape&&w(this.element).addClass(" ch-"+this.settings.tiles.shape),e=h;0<e;e--){var r=l-e,d=i;r<0&&(--d,r+=12);var m=moment().set({month:r,year:d}).format("MMM");this.settings.labels.custom.monthLabels&&(m="array"===w.type(this.settings.labels.custom.monthLabels)?this.settings.labels.custom.monthLabels[r]||"":moment().set({month:r,year:d}).format(this.settings.labels.custom.monthLabels)),w(".ch-year",this.element).append('<div class="ch-month"></div>'),w(".ch-month:last",this.element).append('<div class="ch-weeks"></div>'),this.settings.labels.months&&w(".ch-month:last",this.element).append('<div class="ch-month-label">'+m+"</div>");var c=moment().set({month:r,year:d}).daysInMonth();w(".ch-month:last .ch-weeks",this.element).append('<div class="ch-week"></div>');for(var p=0,u=0;u<c;u++){var g=d+"-"+this.pad(r+1,2);g+="-"+this.pad(u+1,2);var f=this.matchDate(a,g),v="";if(this.futureDate(g)&&(v=" is-after-today"),f){var y=f.count+" on ";y+=moment(f.date).format("ll");var b="";this.settings.coloring&&(b=" "+this.settings.coloring+"-"+f.level),w("<div/>",{class:"ch-day lvl-"+f.level+b,title:y,"data-toggle":"tooltip"}).appendTo(w(".ch-month:last .ch-weeks .ch-week:last",this.element))}else w("<div/>",{class:"ch-day"+v}).appendTo(w(".ch-month:last .ch-weeks .ch-week:last",this.element));p++,moment().set({date:u+2,month:r,year:d}).isoWeekday()===o&&u<c-1&&(w(".ch-month:last .ch-weeks",this.element).append('<div class="ch-week">'+u+"</div>"),p=0)}for(;p<7;p++)w(".ch-month:last .ch-weeks .ch-week:last",this.element).append('<div class="ch-day is-outside-month"></div>')}if(this.settings.legend.show)for(w("<div>",{class:"ch-legend"}).appendTo(this.element).append("<small>"+(this.settings.legend.minLabel||"")+"</small>").append('<ul class="ch-lvls"></ul>').append("<small>"+(this.settings.legend.maxLabel||"")+"</small>"),"left"===this.settings.legend.align&&w(".ch-legend",this.element).addClass("ch-legend-left"),"center"===this.settings.legend.align&&w(".ch-legend",this.element).addClass("ch-legend-center"),e=0;e<n.length;e++)w("<li>",{class:"ch-lvl lvl-"+e,title:n[e],"data-toggle":"tooltip"}).appendTo(w(".ch-lvls",this.element)),this.settings.coloring&&w(".ch-lvls li:last",this.element).addClass(this.settings.coloring+"-"+e);this.settings.tooltips.show&&"function"==typeof w.fn.tooltip&&w('[data-toggle="tooltip"]',this.element).tooltip(this.settings.tooltips.options)}}}),w.fn[a]=function(t,e){return this.each(function(){w.data(this,"plugin_"+a)||w.data(this,"plugin_"+a,new s(this,t,e))})}}(jQuery);